<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>COMP330 Lecture 01: Simple Demo</title>
</head>

<body>
<!--
//GARETH: Define a canvas in the page body and call it 'canvas'
-->
<canvas id="canvas"></canvas>
</body>
</html>

<script>
    //
    //GARETH:   This is some boilerplate code that will hide screen edges on the
    //          browser
    //
    document.documentElement.style.overflow = 'hidden';  // firefox, chrome
    document.body.scroll = "no"; // ie only
    document.body.style.padding = 0;
    document.body.style.margin = 0;


    var playAreaSize = 600;

    var xDir = 20;
    var yDir = 0;

    var snakeXPos = 0;
    var snakeYPos = 0;

    var snakeBodyPos = [[0,0]];

    var snakeBodyLength = 1;

    var pixelsToMovePerTick = 20;
    
    var appleX = 0;
    var appleY = 0;
    placeApple();

    //
    //GARETH:   setInterval() is the magic glue that makes html pages animate.
    //          It takes a function() that contains all the code that will get
    //          executed each iteration and the number of mS between each iteration
    //          Given that 60fps is 1000mS/60 = 16.666, I use 17
    //
    setInterval(function()
    {
        //GARETH: get the canvas component from the HTML document and pick up the 2D context
        var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext("2d");

        //GARETH: set the canvas size to the current window size, else bits wont get drawn to
        ctx.canvas.width  = window.innerWidth;
        ctx.canvas.height = window.innerHeight;

        //GARETH: draw a rectangle that's the size of the screen, this will clear it
        ctx.fillStyle = 'rgba(32,32,32,255)';
        ctx.fillRect(0,0,window.innerWidth, window.innerHeight);

	//Draw play area
	ctx.fillStyle = 'rgba(255,255,255,255)';
	ctx.fillRect(0,0,playAreaSize,playAreaSize);

	//Max - Update snakes body position
	for(var i = snakeBodyLength - 1; i > 0; i-=1)
	{
		snakeBodyPos[i] = snakeBodyPos[i-1];
	}
	
	snakeBodyPos[0] = [snakeXPos,snakeYPos];
	//Max - move the snake in the current direction
	snakeXPos += xDir;
	snakeYPos += yDir;

	

	
	//Max - Check if the snake is on the apple
	if(snakeXPos == appleX && snakeYPos == appleY)
	{
		placeApple();
	}
	
	//Max - Draw the snake's head
	ctx.fillStyle = 'rgba(0,255,0,255)';
	ctx.fillRect(snakeXPos,snakeYPos,20,20);	
	
	//Max - Draw the snake's body
	ctx.fillStyle = 'rgba(0,0,255,255)';
	for(var i = 0; i < snakeBodyLength; i+=1)
	{
		ctx.fillRect(snakeBodyPos[i][0],snakeBodyPos[i][1],20,20);
	}

	//Max - Draw the apple
	ctx.fillStyle = 'rgba(255,0,0,255)';
	ctx.fillRect(appleX,appleY,20,20);
	
	//Max - Check if play area exceeded
	if(snakeXPos >= playAreaSize || snakeXPos < 0 || snakeYPos >= playAreaSize || snakeYPos < 0)
	{
		reset();
	}
	//Max - Check if head collides with body
	for(var i = 0; i < snakeBodyLength; i++)
	{
		if(snakeXPos == snakeBodyPos[i][0] && snakeYPos == snakeBodyPos[i][1])
		{
			reset();
		}
	}
	
    	
	
	//placeApple();
    },100);

    function placeApple()
    {
	appleX = Math.floor(Math.random() * 30) * 20;
	appleY = Math.floor(Math.random() * 30) * 20;
	snakeBodyLength++;
    }

    function onKeyPress(e)
    {
        var keyCode = e.keyCode;

	if(keyCode == 119 && yDir == 0){xDir = 0; yDir = -pixelsToMovePerTick ;}
	else if(keyCode == 100 && xDir == 0){xDir = pixelsToMovePerTick ; yDir = 0;}
	else if(keyCode == 97 && xDir == 0){xDir = -pixelsToMovePerTick ; yDir = 0;}
	else if(keyCode == 115 && yDir == 0){xDir = 0; yDir = pixelsToMovePerTick ;}
    }

    function reset()
    {
	snakeXPos = 0;
	snakeYPos = 0;
	xDir = 20;
	yDir = 0;

	snakeBodyLength = 1;
	placeApple();
    }

    //Listen for a keypress
    window.addEventListener('keypress',onKeyPress);


</script>